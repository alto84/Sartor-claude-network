metadata:
  name: data_store
  version: 1.0.0
  description: Store, retrieve, and manage data in the network's distributed storage system
  category: core/data
  tags:
    - data
    - storage
    - persistence
    - essential
    - crud
  author: Sartor Network Core
  created: 2025-11-03
  updated: 2025-11-03
  dependencies: []
  permissions:
    - data_read
    - data_write
    - storage_access

parameters:
  - name: operation
    type: string
    description: Storage operation to perform
    required: true
    validation:
      enum:
        - store
        - retrieve
        - update
        - delete
        - list
        - search
        - backup
        - restore

  - name: key
    type: string
    description: Unique key for data item
    required: false
    validation:
      pattern: "^[a-zA-Z0-9_/.:-]+$"
      max: 256

  - name: data
    type: dict
    description: Data to store or update
    required: false

  - name: namespace
    type: string
    description: Namespace for data isolation
    required: false
    default: default
    validation:
      pattern: "^[a-zA-Z0-9_-]+$"

  - name: metadata
    type: dict
    description: Metadata about the data
    required: false
    default: {}

  - name: ttl
    type: integer
    description: Time to live in seconds (0 for permanent)
    required: false
    default: 0
    validation:
      min: 0
      max: 31536000  # 1 year

  - name: encryption
    type: boolean
    description: Whether to encrypt the data
    required: false
    default: false

  - name: compression
    type: boolean
    description: Whether to compress the data
    required: false
    default: false

  - name: query
    type: dict
    description: Query parameters for search operation
    required: false

  - name: options
    type: dict
    description: Additional operation-specific options
    required: false
    default: {}

outputs:
  - name: success
    type: boolean
    description: Whether the operation succeeded

  - name: key
    type: string
    description: Key of the stored/retrieved item

  - name: data
    type: dict
    description: Retrieved or processed data

  - name: metadata
    type: dict
    description: Metadata about the operation
    schema:
      properties:
        timestamp:
          type: string
        size_bytes:
          type: integer
        version:
          type: integer
        checksum:
          type: string

  - name: items
    type: list
    description: List of items for list/search operations

  - name: stats
    type: dict
    description: Operation statistics
    schema:
      properties:
        operation_time_ms:
          type: integer
        items_affected:
          type: integer
        storage_used_bytes:
          type: integer

execution:
  type: workflow
  steps:
    - name: validate_operation
      description: Validate operation parameters
      actions:
        - type: check_operation_type
        - type: validate_required_params
        - type: check_permissions

    - name: prepare_data
      description: Prepare data for operation
      condition:
        operation_in: [store, update]
      actions:
        - type: serialize_data
        - type: apply_compression
          condition:
            compression: true
        - type: apply_encryption
          condition:
            encryption: true
        - type: calculate_checksum

    - name: execute_operation
      description: Execute the requested operation
      branches:
        - name: store_operation
          condition:
            operation: store
          actions:
            - type: generate_key_if_needed
            - type: check_key_uniqueness
            - type: write_to_storage
            - type: update_index

        - name: retrieve_operation
          condition:
            operation: retrieve
          actions:
            - type: locate_data
            - type: read_from_storage
            - type: decrypt_if_needed
            - type: decompress_if_needed

        - name: update_operation
          condition:
            operation: update
          actions:
            - type: retrieve_existing
            - type: merge_changes
            - type: increment_version
            - type: write_to_storage

        - name: delete_operation
          condition:
            operation: delete
          actions:
            - type: locate_data
            - type: backup_before_delete
            - type: remove_from_storage
            - type: update_index

        - name: list_operation
          condition:
            operation: list
          actions:
            - type: query_index
            - type: filter_results
            - type: sort_results
            - type: paginate

        - name: search_operation
          condition:
            operation: search
          actions:
            - type: build_query
            - type: execute_search
            - type: rank_results
            - type: format_results

    - name: handle_ttl
      description: Set up TTL if specified
      condition:
        ttl_greater_than: 0
      actions:
        - type: schedule_expiration
        - type: add_ttl_metadata

    - name: update_metrics
      description: Update storage metrics
      actions:
        - type: calculate_storage_used
        - type: update_operation_stats
        - type: log_operation

    - name: replicate
      description: Replicate data across network
      condition:
        options.replicate: true
      actions:
        - type: identify_replica_nodes
        - type: distribute_data
        - type: verify_replication

storage_backends:
  firebase:
    type: realtime_database
    use_for:
      - real_time_data
      - small_frequent_updates
      - agent_state

  github:
    type: file_storage
    use_for:
      - large_files
      - versioned_data
      - knowledge_base

  local:
    type: file_system
    use_for:
      - cache
      - temporary_data
      - offline_queue

data_organization:
  namespaces:
    - default: General purpose storage
    - agents: Agent-specific data
    - tasks: Task-related data
    - knowledge: Knowledge base entries
    - skills: Skill definitions and state
    - metrics: Performance metrics
    - cache: Temporary cache data

  key_patterns:
    agent_data: "agents/{agent_id}/{data_type}"
    task_data: "tasks/{task_id}/{data_type}"
    knowledge: "knowledge/{category}/{topic}"
    metrics: "metrics/{metric_type}/{timestamp}"

indexing:
  strategies:
    - full_text: For searchable content
    - metadata: For filtering and sorting
    - timestamp: For time-based queries
    - tags: For categorical organization

  indices:
    - by_namespace
    - by_creation_time
    - by_update_time
    - by_size
    - by_tags
    - by_owner

examples:
  - name: store_task_result
    description: Store results from a completed task
    inputs:
      operation: store
      key: "tasks/task_12345/results"
      data:
        status: completed
        output: "Analysis complete"
        metrics:
          duration: 120
          accuracy: 95.5
      namespace: tasks
      metadata:
        task_id: task_12345
        agent_id: desktop_agent
      ttl: 604800  # 1 week

  - name: retrieve_agent_profile
    description: Retrieve an agent's profile data
    inputs:
      operation: retrieve
      key: "agents/desktop_agent/profile"
      namespace: agents

  - name: search_knowledge
    description: Search for knowledge entries
    inputs:
      operation: search
      namespace: knowledge
      query:
        text: "house maintenance"
        tags: ["practical", "daily"]
        limit: 10

  - name: update_metrics
    description: Update performance metrics
    inputs:
      operation: update
      key: "metrics/daily/2025-11-03"
      data:
        tasks_completed: 45
        average_duration: 85
        success_rate: 92
      namespace: metrics

performance:
  operation_latency:
    store: 10-50ms
    retrieve: 5-20ms
    update: 15-60ms
    delete: 10-30ms
    list: 20-100ms
    search: 50-500ms

  throughput:
    reads_per_second: 10000
    writes_per_second: 1000
    searches_per_second: 100

  storage_limits:
    max_item_size: 10MB
    max_key_length: 256
    max_namespace_size: 1GB

error_handling:
  - error: key_already_exists
    action: return_error_or_update
    message: "Key already exists, use update operation"

  - error: key_not_found
    action: return_null
    message: "Key not found in storage"

  - error: storage_quota_exceeded
    action: cleanup_and_retry
    message: "Storage quota exceeded, cleanup initiated"

  - error: invalid_data_format
    action: return_error
    message: "Data format is invalid"

  - error: permission_denied
    action: return_error
    message: "Insufficient permissions for operation"

data_integrity:
  checksums:
    algorithm: sha256
    verify_on_read: true

  versioning:
    enabled: true
    max_versions: 10
    conflict_resolution: last_write_wins

  backup:
    automatic: true
    frequency: daily
    retention: 30 days

testing:
  unit_tests:
    - test_all_operations
    - test_data_validation
    - test_compression_encryption
    - test_ttl_expiration

  integration_tests:
    - test_cross_namespace_isolation
    - test_replication
    - test_concurrent_access
    - test_large_data_handling

  stress_tests:
    - test_high_volume_writes
    - test_concurrent_operations
    - test_storage_limits